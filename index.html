<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Simulateur de co√ªt maison</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header>
      <h1>Simulateur de co√ªt d'une maison</h1>
      <div class="actions">
        <div class="configs">
          <label for="configSelect"><small>Configuration</small></label>
          <select id="configSelect" title="S√©lectionner une configuration"></select>
          <button id="newConfigBtn" class="small" title="Nouvelle configuration">Nouveau</button>
          <button id="saveConfigBtn" class="small" title="Sauver la configuration">Save</button>
          <button id="copyConfigBtn" class="small" title="Copier/√©craser une configuration">Copier</button>
          <button id="deleteConfigBtn" class="small warn" title="Supprimer la configuration">Supprimer</button>
          <button id="importLocalToDriveBtn" class="small" style="display:none" title="Copier une config locale vers Google Drive">Copier local ‚Üí Drive</button>
          <span class="spacer"></span>
          <button id="googleDriveConnectBtn" class="small" title="Se connecter √† Google Drive">Google Drive: Connexion</button>
          <button id="googleDriveDisconnectBtn" class="small" style="display:none" title="Se d√©connecter de Google Drive">D√©connexion</button>
          <span id="googleDriveStatus" class="muted" style="display:none"></span>
        </div>
        <div class="menu">
          <button id="moreMenuBtn" class="icon-btn" aria-haspopup="true" aria-expanded="false" aria-controls="moreMenu" title="Plus d'options">‚ãÆ</button>
          <div id="moreMenu" class="dropdown" role="menu" hidden>
            <button id="saveBtn" class="dropdown-item" role="menuitem">üíæ Exporter en JSON</button>
            <label class="dropdown-item" for="loadInput" role="menuitem">üìÇ Importer un JSON</label>
          </div>
        </div>
        <input id="loadInput" type="file" accept="application/json,.json" />
      </div>
  <div id="defaultsError" class="warn" style="display:none" aria-live="polite"></div>
    </header>

    <main>
      <section class="card" id="purchase-section">
        <h2>Achat et parts</h2>
        <div class="grid two">
          <div class="field">
            <label for="purchasePrice">Montant d'achat (‚Ç¨)</label>
            <input id="purchasePrice" type="number" min="0" step="100" />
          </div>
          <div class="field">
            <label for="amortYears">Amortissement (ann√©es)</label>
            <input id="amortYears" type="number" min="1" step="1" />
          </div>
        </div>

        <div class="participants">
          <div class="participants-header">
            <h3>Participants et parts (%)</h3>
            <button id="addParticipantBtn" class="small">+ Ajouter un participant</button>
          </div>
          <div id="participantsWarning" class="warn" aria-live="polite"></div>
          <table>
            <thead>
              <tr>
                <th>Nom</th>
                <th>Part (%)</th>
                <th>Montant d'achat de la part</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="participantsTbody"></tbody>
            <tfoot>
              <tr>
                <td class="right"><strong>Total</strong></td>
                <td><strong id="participantsPercentTotal">0%</strong></td>
                <td><strong id="participantsAmountTotal">0‚Ç¨</strong></td>
                <td></td>
              </tr>
            </tfoot>
          </table>
        </div>
      </section>

      <section class="card" id="charges-section">
        <h2>Charges annuelles</h2>
        <div class="charges-header">
          <div style="display:flex; gap:8px;">
            <button id="addChargeBtn" class="small">+ Ajouter une charge</button>
          </div>
        </div>
        <table>
          <thead>
            <tr>
              <th>Nom</th>
              <th>Type</th>
              <th>Montant annuel (‚Ç¨)</th>
              <th>Montant total (‚Ç¨)</th>
              <th>Dur√©e (ans)</th>
              <th>Calcul√© (‚Ç¨/an)</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="chargesTbody"></tbody>
          <tfoot>
            <tr>
              <td class="right"><strong>Total charges</strong></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td><strong id="chargesTotal">0‚Ç¨</strong></td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </section>

      <section class="card" id="annual-section">
        <h2>Co√ªt annuel</h2>
        <div class="grid three">
          <div class="metric">
            <div class="label">Amortissement annuel</div>
            <div class="value" id="amortAnnual">0‚Ç¨</div>
          </div>
          <div class="metric">
            <div class="label">Total charges</div>
            <div class="value" id="chargesAnnual">0‚Ç¨</div>
          </div>
          <div class="metric primary">
            <div class="label">Co√ªt annuel total</div>
            <div class="value" id="annualTotal">0‚Ç¨</div>
          </div>
        </div>
      </section>

      <section class="card" id="people-categories-section">
        <h2>Acc√®s et cat√©gories</h2>
        <div class="grid two">
          <div>
            <div class="participants-header">
              <h3>Cat√©gories</h3>
              <button id="addCategoryBtn" class="small">+ Ajouter cat√©gorie</button>
            </div>
            <table>
              <thead>
                <tr>
                  <th>Nom</th>
                  <th>% du prix co√ªtant</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="categoriesTbody"></tbody>
            </table>
          </div>
          <div>
            <div class="participants-header">
              <h3>Personnes autoris√©es</h3>
              <button id="addPersonBtn" class="small">+ Ajouter personne</button>
            </div>
            <table>
              <thead>
                <tr>
                  <th>Nom</th>
                  <th>Cat√©gorie</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="peopleTbody"></tbody>
            </table>
          </div>
        </div>
      </section>

      <section class="card" id="weeks-section">
        <h2>R√©partition des semaines</h2>
        <p class="hint">
          Saisissez un nom pour les semaines utilis√©es. Les semaines sans nom ne comptent pas. Utilisez le % pour ajuster le co√ªt (haute saison, hiver, ...). Le prix r√©el d'une semaine est toujours √©gal au prix sugg√©r√© (cat√©gorie incluse) ou au prix r√©vis√© si vous le renseignez.
        </p>
        <div class="grid two" style="margin: 8px 0 12px;">
          <div class="field">
            <label for="yearSelect">Ann√©e</label>
            <input id="yearSelect" type="number" min="1970" max="2100" step="1" />
          </div>
        </div>
        <div class="weeks-summary grid four">
          <div class="metric">
            <div class="label">Semaines utilis√©es</div>
            <div class="value" id="usedWeeks">0</div>
          </div>
          <div class="metric">
            <div class="label">Somme des %</div>
            <div class="value" id="sumWeights">0%</div>
          </div>
          <div class="metric">
            <div class="label">Prix de base (100%)</div>
            <div class="value" id="baseWeekPrice">0‚Ç¨</div>
          </div>
          <div class="metric primary">
            <div class="label">Somme des semaines</div>
            <div class="value" id="sumWeeksPrices">0‚Ç¨</div>
          </div>
        </div>

        <div class="weeks-table-container">
          <table class="weeks">
            <thead>
              <tr>
                <th>Semaine</th>
                <th>Dates</th>
                <th>%</th>
                <th>Personne</th>
                <th>Prix sugg√©r√©</th>
                <th>Prix r√©vis√©</th>
                <th>Prix r√©el</th>
              </tr>
            </thead>
            <tbody id="weeksTbody"></tbody>
          </table>
        </div>
      </section>

      <section class="card" id="participants-summary-section">
        <h2>R√©sum√© par participant</h2>
        <div class="table-scroll participants-summary-container">
        <table>
          <thead>
            <tr>
              <th>Nom</th>
              <th>Part (%)</th>
              <th>Part du co√ªt annuel</th>
              <th>Co√ªt emprunt (‚Ç¨/an)</th>
              <th>Valeur des semaines utilis√©es personnellement (‚Ç¨/an)</th>
              <th>Locations attribu√©es (‚Ç¨/an)</th>
              <th>Revenu (‚Ç¨/an)</th>
              <th>Co√ªt net (‚Ç¨/an)</th>
            </tr>
          </thead>
          <tbody id="participantsSummaryTbody"></tbody>
          <tfoot>
            <tr>
              <td class="right"><strong>Total</strong></td>
              <td><strong id="summaryPercentTotal">0%</strong></td>
              <td><strong id="summaryShareTotal">0‚Ç¨</strong></td>
              <td><strong id="summaryLoanTotal">0‚Ç¨</strong></td>
              <td><strong id="summarySelfPaidTotal">0‚Ç¨</strong></td>
              <td><strong id="summaryRentTotal">0‚Ç¨</strong></td>
              <td><strong id="summaryRevenueTotal">0‚Ç¨</strong></td>
              <td><strong id="summaryNetTotal">0‚Ç¨</strong></td>
            </tr>
          </tfoot>
        </table>
        </div>
      </section>
    </main>

    <script src="script.js"></script>
    <script>
      (function(){
        const btn = document.getElementById('moreMenuBtn');
        const menu = document.getElementById('moreMenu');
        if (!btn || !menu) return;
        function close(){ menu.hidden = true; btn.setAttribute('aria-expanded','false'); }
        btn.addEventListener('click', (e)=>{
          const open = menu.hidden !== false ? false : true;
          if (open) { close(); }
          else { menu.hidden = false; btn.setAttribute('aria-expanded','true'); }
        });
        document.addEventListener('click', (e)=>{
          if (!menu.hidden && !menu.contains(e.target) && e.target !== btn){ close(); }
        });
        window.addEventListener('keydown', (e)=>{ if (e.key === 'Escape') close(); });
      })();
    </script>
  </body>
</html>
